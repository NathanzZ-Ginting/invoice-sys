.PHONY: help dev build clean docker-up docker-down

help: ## Show this help
	@echo "Invoice System Microservices"
	@echo ""
	@echo "Available commands:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

dev: ## Run all services in development mode
	@echo "ğŸš€ Starting all microservices..."
	@make -j6 dev-gateway dev-customer dev-invoice dev-payment dev-analytics dev-notification

dev-gateway: ## Run API Gateway
	@echo "ğŸŒ Starting API Gateway..."
	@cd services/api-gateway/cmd && go run main.go

dev-customer: ## Run Customer Service
	@echo "ğŸ‘¥ Starting Customer Service..."
	@cd services/customer-service/cmd && go run main.go

dev-invoice: ## Run Invoice Service
	@echo "ğŸ“„ Starting Invoice Service..."
	@cd services/invoice-service/cmd && go run main.go

dev-payment: ## Run Payment Service
	@echo "ğŸ’° Starting Payment Service..."
	@cd services/payment-service/cmd && go run main.go

dev-analytics: ## Run Analytics Service
	@echo "ğŸ“Š Starting Analytics Service..."
	@cd services/analytics-service/cmd && go run main.go

dev-notification: ## Run Notification Service
	@echo "ğŸ“§ Starting Notification Service..."
	@cd services/notification-service/cmd && go run main.go

build: ## Build all services
	@echo "ğŸ”¨ Building all services..."
	@cd services/api-gateway/cmd && go build -o ../../../bin/api-gateway
	@cd services/customer-service/cmd && go build -o ../../../bin/customer-service
	@cd services/invoice-service/cmd && go build -o ../../../bin/invoice-service
	@cd services/payment-service/cmd && go build -o ../../../bin/payment-service
	@cd services/analytics-service/cmd && go build -o ../../../bin/analytics-service
	@cd services/notification-service/cmd && go build -o ../../../bin/notification-service
	@echo "âœ… All services built successfully!"

docker-up: ## Start all services with Docker Compose
	@echo "ğŸ³ Starting services with Docker..."
	docker-compose up --build

docker-down: ## Stop all Docker services
	@echo "ğŸ›‘ Stopping Docker services..."
	docker-compose down

clean: ## Clean build artifacts
	@echo "ğŸ§¹ Cleaning..."
	@rm -rf bin/
	@echo "âœ… Cleaned!"

test: ## Run tests for all services
	@echo "ğŸ§ª Running tests..."
	@go test ./services/... -v

.DEFAULT_GOAL := help
